{% extends "base.html" %}

{% block title %}Настройки{% endblock %}

{% block content %}
<div class="container">
    <h1 class="title">Настройки</h1>
    
    <div class="form-container">
        <h2>HTTPS Настройки</h2>
        <form id="https-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label>
                    <input type="checkbox" name="use_https" id="use-https" {% if use_https %}checked{% endif %}>
                    Использовать HTTPS
                </label>
            </div>
            <button type="submit" class="button">Сохранить</button>
        </form>
        
        <h3>Управление сертификатами</h3>
        <button id="generate-test-certs" class="button">Создать тестовые сертификаты</button>
        
        <form id="upload-certs-form" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label>Сертификат (cert.pem)</label>
                <input type="file" name="cert_file" accept=".pem,.crt" required>
            </div>
            <div class="form-group">
                <label>Ключ (key.pem)</label>
                <input type="file" name="key_file" accept=".pem,.key" required>
            </div>
            <button type="submit" class="button">Загрузить сертификаты</button>
        </form>
    </div>

    <div class="form-container">
        <h2>Изменить порт</h2>
        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <label for="port">Текущий порт: {{ port }}</label>
            <input type="text" id="port" name="port" placeholder="Введите новый порт">
            <button type="submit" class="button">Сохранить</button>
        </form>
    </div>
    
    <div class="form-container">
        <h2>Управление пользователями</h2>
        <h3>Добавить пользователя</h3>
        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="text" name="username" placeholder="Логин" required>
            <input type="password" name="password" placeholder="Пароль" required>
            <button type="submit" class="button">Добавить</button>
        </form>
        
        <h3>Список пользователей</h3>
        <ul>
            {% for user in users %}
                <li>{{ user.username }}</li>
            {% endfor %}
        </ul>
        
        <h3>Удалить пользователя</h3>
        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="text" name="delete_username" placeholder="Логин пользователя" required>
            <button type="submit" class="button">Удалить</button>
        </form>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="notifications">
                {% for category, message in messages %}
                    <div class="notification notification-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
</div>
<script src="{{ url_for('static', filename='assets/js/settings.js') }}"></script>
{% endblock %}
